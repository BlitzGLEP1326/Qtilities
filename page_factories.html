<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Qtilities: Factories</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<!-- Generated by Doxygen 1.8.1.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Factories </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><table  cellpadding="0" style="width:100%;
  table-layout:fixed;
	margin:0px 0px 0px 0px;
	border-width:0px 0px 0px 0px; 
	border-color:#7F7F7F;">
<tr>
<td style="width:80%; padding:0px 5px 0px 0px; vertical-align: text-top; text-align: left"><h1 style="margin:0px; padding:0px">Overview</h1>
<p></p>
<p>The C++ factory pattern is a powerful tool which can be used to create objects using only a tag such as a string. The Qtilities libraries provides an advanced Qt friendly factory pattern implementation which allows the developer to easily create factories, and to manage multiple factories in an plugin extendable application.</p>
<p>This article explains a few different concepts, but everything comes together nicely at the end of the article, thus to get the whole picture you would need to hold out and read the whole page.</p>
<p>Table of contents:</p>
<ul>
<li><a class="el" href="page_factories.html#creating_factories">Creating factories</a><ul>
<li><a class="el" href="page_factories.html#example_factory">Basic usage of the factory implementation</a></li>
<li><a class="el" href="page_factories.html#factories_identifying_items">Identifying items within a factory</a></li>
</ul>
</li>
<li><a class="el" href="page_factories.html#managing_factories">Managing factories</a><ul>
<li><a class="el" href="page_factories.html#ifactory_interface">The IFactoryProvider interface</a></li>
<li><a class="el" href="page_factories.html#managing_ifactory_providers">Managing multiple IFactoryProvider instances</a></li>
<li><a class="el" href="page_factories.html#bringing_together">Bringing it all together: The InstanceFactoryInfo struct</a></li>
<li><a class="el" href="page_factories.html#factory_iexportable_relationship">The IExportable interface, what does it have to do with factories?</a></li>
<li><a class="el" href="page_factories.html#factory_debugging">Visual overview of factories using the Debug plugin</a></li>
</ul>
</li>
</ul>
<p class="endtd"></p>
</td><td style="width:20%; vertical-align: top; margin:0px 0px 0px 0px;"><table  style="table-layout:auto;
	margin:0px 0px 0px 0px; 
  width: 100%;
	border-width:0px 0px 0px 0px; 
	border-color:#7F7F7F;
  background-color: #d1d3d4;">
<tr>
<td style="background-color: #5a5c5e; text-align: center"><h2 style="color:#FFFFFF">First Steps</h2>
<p class="endtd"></p>
</td></tr>
<tr>
<td><ul>
<li><a href="page_getting_started.html">Getting Started</a><br/>
</li>
<li><a href="page_the_basics.html">The Basics</a><br/>
</li>
<li><a href="page_examples_and_plugins.html">Examples and Plugins</a><br/>
   </li>
</ul>
</td></tr>
<tr>
<td style="background-color: #5a5c5e; text-align: center"><h2 style="color:#FFFFFF">Overviews</h2>
<p class="endtd"></p>
</td></tr>
<tr>
<td><ul>
<li><a href="page_action_management.html">Action Management</a><br/>
</li>
<li><a href="page_tree_structures.html">Building Trees</a><br/>
</li>
<li><a href="page_debugging.html">Debugging Applications</a><br/>
</li>
<li><a href="page_extension_system.html">Extension System</a><br/>
</li>
<li><a href="page_factories.html">Factories</a><br/>
</li>
<li><a href="page_logging.html">Logging</a><br/>
</li>
<li><a href="page_modules_overview.html">Modules</a><br/>
</li>
<li><a href="page_object_management.html">Object Management</a><br/>
</li>
<li><a href="page_observers.html">Observers</a><br/>
</li>
<li><a href="page_observer_widgets.html">Observer Widgets</a><br/>
</li>
<li><a href="page_project_management.html">Project Management</a><br/>
</li>
<li><a href="page_tasking.html">Tasking</a><br/>
</li>
<li><a href="page_widget_set.html">Widget Set</a><br/>
   </li>
</ul>
</td></tr>
</table>
<p class="endtd"></p>
</td></tr>
</table>
<h1><a class="anchor" id="creating_factories"></a>
Creating factories</h1>
<p>When creating factories there are a few classes that come into play. Lets look at each of these classes:</p>
<ul>
<li><a class="el" href="class_qtilities_1_1_core_1_1_factory.html" title="A factory class which can produce class instances through registered factory interfaces.">Qtilities::Core::Factory</a> : A class which can produce class instances.</li>
<li><a class="el" href="class_qtilities_1_1_core_1_1_factory_interface.html" title="Factory interface which is used by factories to create instances of registered class types...">Qtilities::Core::FactoryInterface</a> : Class defining the interface used by the Factory class.</li>
<li><a class="el" href="class_qtilities_1_1_core_1_1_factory_item.html" title="Factory item class which is used inside classes which can register themselves as items in factories...">Qtilities::Core::FactoryItem</a> : An implementation of the FactoryInterface interface used by objects we want to be able to produce.</li>
<li><a class="el" href="struct_qtilities_1_1_core_1_1_factory_item_i_d.html" title="A structure storing data related to a factory interface.">Qtilities::Core::FactoryItemID</a> : A struct used to identify a factory interface registered within a factory.</li>
</ul>
<p>The image below provides a visualization of the interaction between these classes.</p>
<div class="image">
<img src="factory_classes.jpg" alt="factory_classes.jpg"/>
<div class="caption">
Factory Creation Classes</div></div>
 <h2><a class="anchor" id="example_factory"></a>
Basic usage of the factory implementation</h2>
<p>The factory implementation is best described by an example. In the example we have a base class <code>ExampleBase</code> which is the base class used by the factory. <code>ProduceMe</code> is the class which is registered in the factory and it is able to produce instances of <code>ProduceMe</code>.</p>
<div class="fragment"><div class="line"><span class="comment">// --------------------------------------------</span></div>
<div class="line"><span class="comment">// The following goes into your header file, lets say ProduceMe.h</span></div>
<div class="line"><span class="comment">// --------------------------------------------</span></div>
<div class="line"><span class="preprocessor">#include &lt;QtilitiesCore&gt;</span></div>
<div class="line"><span class="comment">// Be careful of namespace pollution, this is just an example.</span></div>
<div class="line"><span class="keyword">using namespace </span>QtilitiesCore;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Base class:</span></div>
<div class="line"><span class="keyword">class </span>ExampleBase {</div>
<div class="line">    ExampleBase() {}</div>
<div class="line">    <span class="keyword">virtual</span> ~ExampleBase() {}</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ProduceMe class derived from ExampleBase:</span></div>
<div class="line"><span class="keyword">class </span>ProduceMe : <span class="keyword">public</span> ExampleBase {</div>
<div class="line">    ProduceMe() : ExampleBase() {}</div>
<div class="line">    ~ProduceMe() {}</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Make this class a factory item:</span></div>
<div class="line">    <span class="keyword">static</span> FactoryItem&lt;ExampleBase, ProduceMe&gt; factory;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// --------------------------------------------</span></div>
<div class="line"><span class="comment">// The following goes into ProduceMe.cpp</span></div>
<div class="line"><span class="comment">// --------------------------------------------</span></div>
<div class="line">FactoryItem&lt;ExampleBase, ProduceMe&gt; ProduceMe::factory;</div>
<div class="line"></div>
<div class="line"><span class="comment">// --------------------------------------------</span></div>
<div class="line"><span class="comment">// You can now produce instances of the ProduceMe class as follows:</span></div>
<div class="line"><span class="comment">// --------------------------------------------</span></div>
<div class="line">Factory&lt;ExampleBase&gt; exampleFactory;</div>
<div class="line">FactoryItemID produce_me_id(<span class="stringliteral">&quot;Example Tag&quot;</span>);</div>
<div class="line">exampleFactory.registerFactoryInterface(&amp;ProduceMe::factory,produce_me_id);</div>
<div class="line"></div>
<div class="line"><span class="comment">// We can create instances of ProduceMe as follows:</span></div>
<div class="line">ExampleBase* base_inst = exampleFactory.createInstance(produce_me_id.tag);</div>
<div class="line">ProduceMe* produceMe_inst = qobject_cast&lt;ProduceMe*&gt; (base_inst);</div>
</div><!-- fragment --><h2><a class="anchor" id="factories_identifying_items"></a>
Identifying items within a factory</h2>
<p>In the example above we used the <a class="el" href="struct_qtilities_1_1_core_1_1_factory_item_i_d.html" title="A structure storing data related to a factory interface.">Qtilities::Core::FactoryItemID</a> struct which contains all the information necessary to register and create a specific instance in the factory. This structure has the ability to not only define a tag which can be used to produce the object, it can also provide other information along with the tag. Lets take a look at the information it provides for each factory interface registered:</p>
<ul>
<li>Interface Tag: The tag which can be used to produce a new instance of the interface using the Factory::newInstance() method.</li>
<li>Interface Category: The category to which this interface belongs. Categories can be used to display the available interfaces registered in a factory in a categorized manner.</li>
<li>Interface Contexts: A list of contexts which must be associated with this interface.</li>
</ul>
<p>To produce the object only the tag is required, but to group factory interfaces properly the other fields can be used.</p>
<h1><a class="anchor" id="managing_factories"></a>
Managing factories</h1>
<p>As an application gets bigger there is often a need for multiple factories. When managing factories there's a different set of classes that come into play. Lets look at each of these classes:</p>
<ul>
<li><a class="el" href="class_qtilities_1_1_core_1_1_interfaces_1_1_i_factory_provider.html" title="Objects managing instances of factories can implement this interface if they want to expose these fac...">Qtilities::Core::Interfaces::IFactoryProvider</a> : An interface exposing a set of factories.</li>
<li><a class="el" href="class_qtilities_1_1_core_1_1_instance_factory_info.html" title="The InstanceFactoryInfo struct contains all the information required to create an object instance usi...">Qtilities::Core::InstanceFactoryInfo</a> : A struct used to identify a factory interface registered within a factory exposed by an object implementing IFactoryProvider.</li>
<li><a class="el" href="class_qtilities_1_1_core_1_1_object_manager.html" title="The ObjectManager provides object management features to the developer.">Qtilities::Core::ObjectManager</a> : The object manager class which is used in many other places in Qtilities as well. Used to register objects which implements the IFactoryProvider interface.</li>
</ul>
<p>While reading through this section it is important to note that the factory management classes can be used with any factory implementation. It is not necessary to use the Qtilities factory classes in order to use the factory management classes.</p>
<h2><a class="anchor" id="ifactory_interface"></a>
The IFactoryProvider interface</h2>
<p>The goal of the factory provider interface is to expose a set of factories and can be implemented by any object which wish to expose one or more factories to the rest of the application. The image below visualizes this concept.</p>
<div class="image">
<img src="factory_management.jpg" alt="factory_management.jpg"/>
<div class="caption">
The Factory Provider Concept</div></div>
<p>The image above shows the functions which can be used to query factories exposed through the interface.</p>
<h2><a class="anchor" id="managing_ifactory_providers"></a>
Managing multiple IFactoryProvider instances</h2>
<p>Implementations of the IFactoryProvider interface can be registered in the object manager using the <a class="el" href="class_qtilities_1_1_core_1_1_interfaces_1_1_i_object_manager.html#aeb93f6f30b6388bdd4766f42ff120d42" title="Registers a factory interface in the object manager.">Qtilities::Core::Interfaces::IObjectManager::registerIFactoryProvider()</a> function. Once registered, it is possible to obtain the factory provider interface which contains a specific factory using the <a class="el" href="class_qtilities_1_1_core_1_1_interfaces_1_1_i_object_manager.html#a189b59843f9c14ac5fff6d4018e6adb2" title="Provides a reference to the factory interface for a specific factory.">Qtilities::Core::Interfaces::IObjectManager::referenceIFactoryProvider()</a> function.</p>
<div class="image">
<img src="object_manager_ifactoryprovider.jpg" alt="object_manager_ifactoryprovider.jpg"/>
<div class="caption">
Managing Multiple IFactoryProviders</div></div>
 <h2><a class="anchor" id="bringing_together"></a>
Bringing it all together: The InstanceFactoryInfo struct</h2>
<p>When looking closely at the previous sections, it is observed that we need the following information to create an instance of an object in a factory exposed through the IFactoryProvider interface:</p>
<ul>
<li>The name of the factory.</li>
<li>The tag associated with the factory interface which can produce the object.</li>
</ul>
<p>The <a class="el" href="class_qtilities_1_1_core_1_1_instance_factory_info.html" title="The InstanceFactoryInfo struct contains all the information required to create an object instance usi...">Qtilities::Core::InstanceFactoryInfo</a> struct was created for this exact reason. It provides all the information needed to locate the needed factory through the object manager, as well as the tag to use in that factory.</p>
<h2><a class="anchor" id="factory_iexportable_relationship"></a>
The IExportable interface, what does it have to do with factories?</h2>
<p>As discussed in the previous section, a <a class="el" href="class_qtilities_1_1_core_1_1_instance_factory_info.html" title="The InstanceFactoryInfo struct contains all the information required to create an object instance usi...">Qtilities::Core::InstanceFactoryInfo</a> object contains all the information needed to construct an object somewhere in a factory exposed to the object manager. For this reason any object implementing the <a class="el" href="class_qtilities_1_1_core_1_1_interfaces_1_1_i_exportable.html" title="Objects can implement this interface if they are able to export and reconstruct themselves.">Qtilities::Core::Interfaces::IExportable</a> interface must provide an InstanceFactoryInfo object. This way we can reconstruct the object during import operations on the interface. The InstanceFactoryInfo class has constructors for all of the export formats provided by the IExportable interface for this reason.</p>
<p>This gets us to a very important point: When implementing the IExportable interface, the first thing that must be added to the export object (whether it is a QDataStream during binary exporting, or a QDomElement during XML exporting) is the information contained by InstanceFactoryInfo. During import we get this information, construct the object and the call the import functions on the reconstructed object.</p>
<h2><a class="anchor" id="qtilities_factory"></a>
Ready to use factory and factory classes</h2>
<p>The object manager provides a ready to use factory, called the Qtilities factory in the documentation and by <a class="el" href="namespace_qtilities_1_1_core_1_1_constants.html#a9a42d021df8681b326fbd1f7b0292110" title="Factory name of the Qtilities factory.">Qtilities::Core::Constants::qti_def_FACTORY_QTILITIES</a> name in the Qtilities sources. This factory can produce any QObject based class for which a factory interface was registered in the object manager. Many of the Qtilities classes are registered by default and can be produced using this factory (See <a class="el" href="page_factories.html#factory_debugging">Visual overview of factories using the Debug plugin</a>).</p>
<p>Lets look at an example where we create change the <code>ProduceMe</code> class in the above example. We make it QObject based, register it in the Qtilities factory and then produce it:</p>
<div class="fragment"><div class="line"><span class="comment">// --------------------------------------------</span></div>
<div class="line"><span class="comment">// The following goes into your header file, lets say ProduceMe.h</span></div>
<div class="line"><span class="comment">// --------------------------------------------</span></div>
<div class="line"><span class="comment">// ProduceMe class derived from QObject:</span></div>
<div class="line"><span class="keyword">class </span>ProduceMe : <span class="keyword">public</span> QObject {</div>
<div class="line">    ProduceMe(Qbject* parent = 0) : QObject(parent) {}</div>
<div class="line">    ~ProduceMe() {}</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Make this class a factory item:</span></div>
<div class="line">    <span class="keyword">static</span> FactoryItem&lt;QObject, ProduceMe&gt; factory;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// --------------------------------------------</span></div>
<div class="line"><span class="comment">// The following goes into ProduceMe.cpp</span></div>
<div class="line"><span class="comment">// --------------------------------------------</span></div>
<div class="line">FactoryItem&lt;QObject, ProduceMe&gt; ProduceMe::factory;</div>
<div class="line"></div>
<div class="line"><span class="comment">// --------------------------------------------</span></div>
<div class="line"><span class="comment">// In the application code:</span></div>
<div class="line"><span class="comment">// --------------------------------------------</span></div>
<div class="line"><span class="comment">// Register ProduceMe in the Qtilities factory:</span></div>
<div class="line">FactoryItemID produce_me_id(<span class="stringliteral">&quot;Example Tag&quot;</span>);</div>
<div class="line">OBJECT_MANAGER-&gt;registerFactoryInterface(&amp;ProduceMe::factory,produce_me_id);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Now we can produce it as follows:</span></div>
<div class="line">InstanceFactoryInfo instance_factory_info(qti_def_FACTORY_QTILITIES,produce_me_id.tag,<span class="stringliteral">&quot;ObjectNameWhenCreated&quot;</span>);</div>
<div class="line">IFactoryProvider* ifactory = OBJECT_MANAGER-&gt;referenceIFactoryProvider(instance_factory_info.d_factory_tag);</div>
<div class="line"><span class="keywordflow">if</span> (ifactory) {</div>
<div class="line">    QObject* obj = ifactory-&gt;createInstance(instance_factory_info);</div>
<div class="line">    obj-&gt;setObjectName(instance_factory_info.d_instance_name);</div>
<div class="line">    ProduceMe* produceMe_inst = qobject_cast&lt;ProduceMe*&gt; (obj);   </div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="factory_debugging"></a>
Visual overview of factories using the Debug plugin</h2>
<p>The <a class="el" href="namespace_qtilities_1_1_plugins_1_1_debug.html" title="Namespace containing all classes which is part of the debug plugin.">Qtilities::Plugins::Debug</a> plugin provides a visual overview of the factory provider interfaces registered in the object manager as well as the tags in each interface. This is shown in the image below:</p>
<div class="image">
<img src="debugging_state_factories.jpg" alt="debugging_state_factories.jpg"/>
<div class="caption">
Factories Overview In The Debug Plugin</div></div>
</div></div><!-- contents -->
<br><table style="table-layout:auto;	margin: auto; 	border-width:0px 0px 0px 0px; 	border-color:#7F7F7F; 	width:99%;	border-style:solid" CELLPADDING=5 RULES=ROWS FRAME=HSIDES><tr><td style="align: left;width:45%"><a href="http://github.com/JPNaude/Qtilities" title="Qtilities Repository">Qtilities</a> : <a href="index.html" title="Go back to index">Reference Documentation</a></td><td style="align: center;width:10%"><a href="#top" title="Back to top">Back to top</a> </td><td style="text-align: right;width:45%">Copyright &copy; 2009-2013, Jaco Naude</tr></table><br><script type="text/javascript">  var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-17785825-1']);  _gaq.push(['_trackPageview']);  (function() {    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);  })();</script>
